# 第一章知识点
## 计算机的主要组成 CPU 主存 输入输出 系统总线
## 微处理器
## 指令的执行
取指执行，第一步是PC来取指令，接着就是循环往复的操作
指令操作的行为，
（1）存储器到处理器
（2）处理器到I/O
（3）
里面有一个图，展示了具体三个指令的执行，开始cpu的向存储器要指令，放到寄存器里面，PC自增
接着，IR里面的指令的意思是加载AC,有两个部分，第一个数值对应取值操作，下面三位是地址

## 中断

# 关键术语

## 一、CPU 与寄存器相关
1.​​中央处理单元（CPU）​​
计算机的核心部件，负责执行程序指令、处理数据。
​​2.程序计数器（PC）​​
存放下一条要执行的指令的内存地址。
​​3.指令寄存器（IR）​​
存放当前正在执行的指令。
​​4.地址寄存器​​
存放要访问的内存地址（用于取指令或数据）。
​​5.数据寄存器​​
临时存放从内存读取或要写入内存的数据。
​​6.辅助寄存器​​
用于辅助运算或地址计算（如索引、基址寄存器）。
​​栈指针（SP）​​
指向当前栈顶地址，用于函数调用、中断处理时保存现场。
​​栈帧​​
函数调用时在栈中分配的一块内存，存放参数、局部变量、返回地址等。
二、内存与缓存相关
​​分级存储体系​​
将存储器分为多级（如缓存-主存-辅存），速度从高到低，容量从低到高，平衡速度与成本。
​​高速缓存（Cache）​​
位于 CPU 和主存之间，存放常用数据副本，提高访问速度。
​​高速缓冲槽（Cache Slot / Cache Line）​​
缓存中存放一块连续数据的基本单位。
​​局部性引用​​
程序访问内存的两种局部性：
​​时间局部性​​：某个数据被访问后很可能再次被访问。
​​空间局部性​​：访问某个地址后，其附近的地址也可能被访问。
​​命中（Hit）​​
CPU 要访问的数据在缓存中找到。
​​未命中（Miss）​​
数据不在缓存中，需从主存或更低层级调入。
​​命中率​​
缓存命中次数占总访问次数的比例。
​​置换算法​​
缓存满时选择替换哪一块数据的策略（如 LRU、FIFO）。
​​块（Block / Line）​​
在主存和缓存之间传输数据的基本单位。
​​槽（Slot）​​
缓存或内存中可存放一个数据块的位置。
​​内存（主存）​​
程序运行时存放指令和数据的存储器（RAM）。
​​辅存（外存）​​
如硬盘、SSD，用于长期存储数据，速度慢但容量大。
三、I/O 与中断相关
​​输入/输出（I/O）​​
CPU 与外部设备（磁盘、键盘、网络等）的数据交换。
​​I/O 模块​​
负责管理外设的控制器，减轻 CPU 负担。
​​可编程 I/O​​
CPU 通过不断查询外设状态来控制 I/O，效率较低。
​​中断驱动 I/O​​
外设准备好后向 CPU 发送中断信号，CPU 再处理 I/O，提高效率。
​​中断​​
硬件或软件发出的信号，通知 CPU 需要处理紧急事件。
​​直接内存存取（DMA）​​
允许外设直接与主存交换数据，不经过 CPU，大幅提升数据传输速率。
四、多核与系统结构
​​多处理器​​
一台计算机中有多个 CPU 共同工作。
​​多核​​
一个物理处理器内包含多个核心，可并行执行任务。
​​芯片多处理器（CMP）​​
即多核处理器，多个核心集成在同一芯片上。
​​系统总线​​
连接 CPU、内存、I/O 模块的数据、地址、控制信号传输线路。
五、指令执行相关
​​指令​​




## 练习
### 复习题
#### 1.1 列出并简要定义计算机的4个主要组成部分。​​
​​处理器（CPU）​​：计算机的“大脑”，负责执行程序中的指令，包括算术运算、逻辑判断、控制其他部件等。
​​主存储器（内存）​​：用于存放正在运行的程序和所需的数据。CPU可以直接访问，速度快但断电后数据会丢失。
​​输入/输出（I/O）模块​​：在计算机内部（如内存、处理器）和外部设备（如磁盘、键盘、显示器）之间传输数据，是内外沟通的桥梁。
​​系统总线​​：连接计算机各个主要组成部分的一组电子线路，负责在它们之间传输数据、地址和控制信号。
#### ​​1.2 定义处理器寄存器的两种主要类别。​​
​​用户可见寄存器​​：程序员可以通过机器指令来使用的寄存器，旨在提高程序执行效率。例如，数据寄存器（存放操作数）、地址寄存器（存放内存地址）。
​​控制和状态寄存器​​：用于控制处理器的操作。通常只能由具有特权的操作系统代码访问。例如，程序计数器（PC，存放下一条指令地址）、指令寄存器（IR，存放当前指令）、程序状态字（PSW，存放各种状态标志，如运算结果是否为0）。
#### ​​1.3 一般而言，一条机器指令能指定的4种不同操作是什么？​​
​​处理器-存储器​​：将数据从处理器（寄存器）传送到内存，或从内存传送到处理器。
​​处理器-I/O​​：通过I/O模块在处理器和外部设备之间传输数据。
​​数据处理​​：处理器对数据执行算术或逻辑运算。
​​控制​​：改变指令的执行顺序（如跳转、循环、调用子程序）。
​​#### 1.4 什么是中断？​​
中断是来自计算机内部（如硬件故障）或外部（如I/O设备）的一个信号，它通知处理器需要暂停当前正在执行的程序，转去处理某个特定事件（如键盘输入、数据接收完成），处理完毕后再恢复被中断的程序。
​​#### 1.5 多个中断的处理方式是什么？​​
主要有两种方式：
​​顺序处理（禁止中断）​​：在处理一个中断时，CPU屏蔽（忽略）其他所有中断，待当前中断处理完毕后再按顺序处理其他中断。优点是简单，缺点是响应速度慢，可能导致高优先级中断丢失。
​​嵌套处理（优先级中断）​​：为不同中断源分配优先级。允许高优先级中断打断正在处理的低优先级中断。这种方式响应及时，但实现更复杂。
​​#### 1.6 内存层次各个元素间的特征是什么？​​
内存层次结构从上到下（从寄存器到外部存储）的特征变化规律是：
​​访问速度​​：递减。
​​存储容量​​：递增。
​​每字节成本​​：递减。
#### ​​1.7 什么是高速缓存？​​
高速缓存（Cache）是位于处理器和主内存之间的一小块、速度极快的存储器。它用于存放主内存中​​最常用​​的指令和数据的副本，其目的是使CPU的访问速度接近Cache的速度，从而弥补CPU和主内存之间的速度差距。
​​#### 1.8 多处理器系统和多核系统的区别是什么？​​
​​多处理器系统​​：指一台计算机中包含​​两个或更多个独立的物理CPU芯片​​，每个CPU都有自己的内部组件，它们通过系统总线连接。
​​多核系统​​：指在​​一个物理CPU芯片内部​​集成了两个或更多个独立的处理器核心（“核”）。这些核心通常共享某些资源（如最后一级缓存、内存控制器），但能并行执行任务。
​​#### 1.9 空间局部性和时间局部性之间的区别是什么？​​
​​时间局部性​​：指程序在不久的将来​​很可能再次访问​​它刚刚访问过的数据或指令（例如，循环体内的指令和变量）。
​​空间局部性​​：指程序在不久的将来​​很可能访问​​其当前访问位置​​附近​​的数据或指令（例如，顺序执行的指令、数组的连续元素）。
#### ​​1.10 开发空间局部性和时间局部性的策略是什么？​​
​​开发时间局部性的策略​​：在高速缓存中保留最近访问过的指令和数据的副本，期望它们很快被再次使用。
​​开发空间局部性的策略​​：当CPU需要从主存获取某个数据时，不仅读取该数据，还一次性读取其相邻的一批数据（称为一个“块”或“行”）到高速缓存中，期望程序很快就会用到这些相邻的数据。


计算机执行的基本操作命令（如加法、跳转）。
​​指令周期​​
CPU 取指令、译码、执行、存结果的一个完整周期。
​​栈（Stack）​​
后进先出（LIFO）的内存区域，用于函数调用、表达式求值等。
## 习题
1.练习一
读懂题目里面的指令 图里面的简化版，把一个数字代表着一个四位数字




<img width="574" height="816" alt="dde31ca40f126ceb6ea03d4f4e776b19" src="https://github.com/user-attachments/assets/2e8533d7-c13b-46e2-a708-353eaa037ac1" />
2.本章用6步描述程序执行情况 受用MAR和MBR来扩充这一描述，给我解答
内存地址寄存器（MAR）​​：CPU要访问内存时，​​必须​​先把要访问的内存地址放入MAR。MAR直接连接到内存的地址总线上，告诉内存：“我要访问这个地址”。
​​内存缓冲寄存器（MBR）​​：当CPU要从内存​​读取​​数据时，读出的数据会先暂存在MBR中，再由CPU取走。当CPU要向内存​​写入​​数据时，要写入的数据也先放入MBR，再由内存从MBR中取走并存入指定地址。

CPU将PC=301送入MAR -> 内存将地址301的指令5941送入MBR -> CPU将MBR的值送入IR，同时PC加1变为302。


3.32位的微处理器，，32位的指令分为两部分
（1）最大的可直接寻址的存储器容量
（2）微处理器具有一下情况
地址总线宽度
数据总线宽度：数据传输
地址总线由很多根导线组成，每一根导线可以传输一个二进制位（0 或 1）。
局部地址总线和系统地址：局部是用于高级缓存专门设定的


不是内存芯片本身慢，而是数据总线带宽限制了内存向 CPU 提供数据的速度，即“带宽瓶颈”。

c. 程序计数器（PC）和指令寄存器（IR）需要多少位？

指令寄存器（IR）：要存放整条指令，指令长度为 32 位，所以 IR 需要 32 位。

程序计数器（PC）：PC 用来保存下一条指令的地址。题中指令使用的直接地址字段为 24 位，处理器需要能寻址整个直接地址空间，因此 PC 需至少 24 位（如果系统实际地址总线更宽，例如情形1 的 32 位地址总线，则 PC 可为 32 位；但基于题目给定的直接地址长度，最小需要 24 位）。

答案： IR = 32 位，PC 最少 24 位（若系统设计使用更宽地址总线则相应增加）。



4.一个微处理器产生16位地址，并且有一个16位的地址总线
连接16位存储器时的最大地址空间​
1.处理器能访问多大的内存空间，直接由​​地址总线的位数​​决定
2.可寻址的地址空间大小​​只与地址总线的位数有关​​，而与​​数据总线的宽度​​无关。
这里8位的存储器是什么意思
3.独立的I/O操作
独立I/O空间（或称“端口映射I/O”）是一种将I/O设备与内存分开编址的方法。I/O设备有自己的地址（端口号），这些地址与内存地址是重叠的。
为了区分处理器发出的一个地址是要访问内存还是I/O设备，需要一条额外的控制线。
4.
一个16位的端口访问可能会占用两个连续的8位端口地址。因此，系统能支持的​​唯一端口地址总数​​上限仍然是256个，与端口的数据宽度无关。
## 问题
处理器能访问多大的内存空间，直接由​​地址总线的位数​​决定。
可寻址的地址空间大小​​只与地址总线的位数有关​​，而与​​数据总线的宽度​​无关。
似乎内存大小和地址总线位数有关，
I/O端口数量由​​输入/输出指令中用于表示端口号的位数​​决定

5.计算机传输速率的一个题目
​​数据传送速率 = 总线频率 × 数据总线宽度

6.关于自己实现一个简单的关于输入输出和cpu之间使用的例子
<img width="962" height="409" alt="image" src="https://github.com/user-attachments/assets/dce337ad-b1ba-45d7-8680-5ab3a162f942" />
（1） 
先一直查询Flag，若标志改变，然后cpu进行操作，读取数据,输入完之后就
输出操作和输入的操作流程一样
（2）中断来提高效率
在程序查询方式中（如 a 中描述），CPU 必须不断地重复执行“检查 FGI/FGO”的指令（忙等待）。由于 I/O 设备（如键盘、打印机）的速度远慢于 CPU，CPU 大部分时间都浪费在等待状态位的检查上，无法有效执行其他计算任务。
传统的行为：在传统的程序查询方式中，CPU 发出 I/O 请求后，并不会立即转去执行其他有用的程序。相反，它会陷入一个紧密的循环中，持续不断地检查 I/O 状态寄存器中的标志位（例如 FGI 或 FGO）。
之前请求I/O的时候要花很多时间，Cpu浪费了，这里就要使用一个中断机制来优化一下，
CPU 在执行完当前指令后，检查到中断请求，暂停当前程序的执行（保存现场），跳转到预先设定的中断服务程序（ISR）。

7.DMA访问内存的优先级高于cpu访问的优先级，原因是什么
DMA的设计，在没有DMA的中断或程序查询方式下，数据在**内存和I/O设备**之间传输时，每一个字节都必须经过CPU。这意味着**CPU需要执行多次读/写指令**，占用大量CPU时间来处理数据搬运，无法执行其他计算任务。

让数据可以直接在 I/O 设备和内存之间传输，完全绕开（或只少量干预）CPU。



8.一个DMA传送字符的速度是9600位/秒，处理器取指令的速度是100万次/秒，DMA会影响多少？
我的思路：取指令，取一次是取多少
一般有32位和64位，假设现在有一个1的，那对一个64位的cpu来说的差异是64000000和9600的差异，不是10000的速度差吗

连接 CPU、内存和 I/O 设备的高速共享通道，包括地址线、数据线和控制线。这是 DMA 和 CPU 竞争的资源。

DMA 访问内存时，暂时中断 CPU 对总线的控制权，**“偷走”**一个或几个总线周期进行数据传输。这是 DMA 影响 CPU 的具体方式。

比较疑惑的点是给我传输的速率量纲不统一，但是量纲的转换我不清楚，把位转换成周期不懂
### 一条指令需要N个周期
时钟周期 (Clock Cycle): 这是 CPU 内部最基本的、最小的时间单元。CPU 的频率（例如 4 GHz）就是时钟周期的倒数。

总线周期 (Bus Cycle): 这是 CPU 访问外部设备（如内存或 I/O 接口）进行数据传输所需的时间。一个总线周期通常包含多个时钟周期。

机器周期 (Machine Cycle): 完成一个基本操作（如取指令、取数据、存数据）所需的时间，通常等于一个总线周期。

<img width="1305" height="711" alt="image" src="https://github.com/user-attachments/assets/6d2faa2f-f5ed-4652-a9c8-e700e935362e" />

DMA传输是以系统字长或总线宽度决定的，不是9600bit/s,而是用每次传的bit数除一下来处理

9.一台计算机包括 CPU、I/O 设备 D、内存 M，通过共享总线连接，数据总线宽度 1 个字。
已知条件：
1.CPU 每秒最多执行 10 6条指令（即 1 MIPS）。
2.平均每条指令需要 5 个处理器周期。其中 3 个周期需要使用存储器总线（访存）。存储器读/写操作占用 1 个总线周期（即 1 个处理器周期）。
3.CPU 以 95% 的效率执行后台程序（无 I/O 指令），即 CPU 时间 95% 用于后台程序，5% 可用于 I/O 相关操作。
4.处理器周期 = 1 个总线周期。
在 M 与 D 之间传送大块数据。
​​问题：​​
(a) 程序控制 I/O（PIO）：每传送 1 个字需要 CPU 执行 2 条指令，求最大 I/O 数据传输速率（字/秒）。
(b) DMA 方式，求数据传输速率（字/秒）。







cpu里面的执行周期 执行一条指令需要N个周期，
这里DMA会窃取cpu的资源来进行计算处理
cpu速率和总线速率有什么区别

